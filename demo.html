<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥æ¨ç®—å¡ - æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            color: #fff;
            margin-bottom: 8px;
        }

        .header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }

        .input-section {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .cards-container {
            margin-top: 20px;
        }

        .card {
            background: #fff;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #667eea;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-weight: 600;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-icon {
            font-size: 20px;
        }

        .card-toggle {
            padding: 4px 12px;
            background: #f5f5f5;
            border-radius: 12px;
            font-size: 14px;
            color: #666;
            transition: all 0.3s;
        }

        .card.expanded .card-toggle {
            background: #667eea;
            color: #fff;
        }

        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .card.expanded .card-content {
            max-height: 500px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .card-content-text {
            color: #666;
            font-size: 13px;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 12px;
            opacity: 0.9;
        }

        .privacy {
            text-align: center;
            padding: 16px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }

        .date-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 12px;
            color: #fff;
            font-size: 12px;
            margin-top: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“± æ¯æ—¥æ¨ç®—å¡</h1>
            <p>åŸºäºç”Ÿæ—¥å’Œå‘¨æ˜“ç®—æ³•çš„ä¸ªæ€§åŒ–æ¨è</p>
            <div class="date-badge" id="dateBadge"></div>
        </div>

        <!-- Input Section -->
        <div class="input-section">
            <div class="input-group">
                <label>ğŸ‚ ç”Ÿæ—¥</label>
                <input type="date" id="birthday" />
            </div>

            <div class="input-group">
                <label>ğŸ‘¤ æ€§åˆ«</label>
                <select id="gender">
                    <option value="unspecified">ä¿å¯†</option>
                    <option value="male">ç”·</option>
                    <option value="female">å¥³</option>
                </select>
            </div>

            <button class="btn" id="generateBtn" disabled>ç”Ÿæˆä»Šæ—¥å¡ç‰‡</button>
        </div>

        <!-- Cards Container -->
        <div class="cards-container" id="cardsContainer">
            <div class="empty">
                <div class="empty-icon">ğŸ”®</div>
                <p>é€‰æ‹©ç”Ÿæ—¥åç‚¹å‡»ç”ŸæˆæŒ‰é’®</p>
            </div>
        </div>

        <!-- Privacy -->
        <div class="privacy">
            ğŸ”’ æ‚¨çš„æ•°æ®ä»…ç”¨äºæ¨ç®—ï¼Œå·²è„±æ•å¤„ç†
        </div>
    </div>

    <script>
        // ç®€åŒ–çš„ fortuneEngine (ä¸å°ç¨‹åºé€»è¾‘ä¸€è‡´)
        const fortuneEngine = {
            hashString(str) {
                let h = 2166136261;
                for (let i = 0; i < str.length; i++) {
                    h ^= str.charCodeAt(i);
                    h = Math.imul(h, 16777619);
                }
                return (h >>> 0);
            },

            lifePathFromBirthday(birthday) {
                const digits = birthday.replace(/[^0-9]/g, "").split("").map(Number);
                let sum = digits.reduce((a, b) => a + b, 0);
                while (sum > 9) {
                    sum = String(sum).split("").reduce((a, ch) => a + Number(ch), 0);
                }
                return sum;
            },

            fiveElementsFromBirthday(birthday) {
                const s = this.hashString(birthday);
                const base = [-2, -1, 0, 1, 2];
                return {
                    wood: base[(s + 0) % 5],
                    fire: base[(s + 1) % 5],
                    earth: base[(s + 2) % 5],
                    metal: base[(s + 3) % 5],
                    water: base[(s + 4) % 5]
                };
            },

            colorFromSeed(seed) {
                const colors = ["#FF6B6B", "#4ECDC4", "#45B7D1", "#FFA07A", "#98D8C8", "#F7DC6F", "#BB8FCE", "#85C1E9", "#F8C471"];
                return colors[seed % colors.length];
            },

            lifePathDesc(n) {
                const ds = {
                    1: "ç‹¬ç«‹ã€åˆ›æ–°ï¼Œå¤©ç”Ÿçš„é¢†å¯¼è€…",
                    2: "åˆä½œã€å’Œè°ï¼Œå–„äºä¸äººå…±äº‹",
                    3: "è¡¨è¾¾ã€æ²Ÿé€šï¼Œå¯Œæœ‰åˆ›é€ åŠ›",
                    4: "åšæŒã€åŠ¡å®ï¼Œè„šè¸å®åœ°",
                    5: "è¡ŒåŠ¨ã€çµæ´»ï¼Œçƒ­çˆ±å†’é™©",
                    6: "è´£ä»»ã€ç…§é¡¾ï¼Œå¯Œæœ‰åŒç†å¿ƒ",
                    7: "åˆ†æã€ç›´è§‰ï¼Œå–„äºæ€è€ƒ",
                    8: "ç›®æ ‡ã€æˆå°±ï¼Œæ³¨é‡ç»“æœ",
                    9: "è§„åˆ’ã€ç†æƒ³ï¼Œæœ‰è¿œè§å“è¯†"
                };
                return ds[n] || "ç‹¬ç‰¹çš„ç”Ÿå‘½é“è·¯";
            },

            luckyNumber(lifePath, hexId) {
                return ((lifePath * 7) + hexId) % 9 + 1;
            },

            hexagramName(hexId) {
                const names = ["ä¹¾ä¸ºå¤©", "å¤ä¸ºåœ°", "æ°´é›·å±¯", "å±±æ°´è’™", "æ°´å¤©éœ€", "å¤©æ°´è®¼", "åœ°æ°´å¸ˆ", "æ°´åœ°æ¯”",
                    "é£å¤©å°ç•œ", "å¤©æ³½å±¥", "åœ°å¤©æ³°", "å¤©åœ°å¦", "å¤©ç«åŒäºº", "ç«å¤©å¤§æœ‰", "åœ°å±±è°¦", "é›·åœ°è±«",
                    "æ³½é›·éš", "å±±é£è›Š", "åœ°æ³½ä¸´", "é£åœ°è§‚", "ç«é›·å™¬å—‘", "å±±ç«è´²", "å±±åœ°å‰¥", "åœ°é›·å¤",
                    "å¤©é›·æ— å¦„", "å±±å¤©å¤§ç•œ", "å±±é›·é¢", "æ³½é£å¤§è¿‡", "åä¸ºæ°´", "ç¦»ä¸ºç«", "æ³½å±±å’¸", "é›·é£æ’",
                    "å¤©å±±é", "é›·å¤©å¤§å£®", "ç«åœ°æ™‹", "åœ°ç«æ˜å¤·", "é£ç«å®¶äºº", "ç«æ³½ç½", "æ°´å±±è¹‡", "é›·æ°´è§£",
                    "å±±æ³½æŸ", "é£é›·ç›Š", "æ³½å¤©å¤¬", "å¤©é£å§¤", "æ³½åœ°èƒ", "åœ°é£å‡", "æ³½æ°´å›°", "æ°´é£äº•",
                    "æ³½ç«é©", "ç«é£é¼", "éœ‡ä¸ºé›·", "è‰®ä¸ºå±±", "é£å±±æ¸", "å½’å¦¹", "é›·æ³½ä¸°", "ç«å±±æ—…",
                    "å·½ä¸ºé£", "å…‘ä¸ºæ³½", "é£æ°´æ¶£", "æ°´æ³½èŠ‚", "é£æ³½ä¸­å­š", "é›·å±±å°è¿‡", "æ°´ç«æ—¢æµ", "ç«æ°´æœªæµ"];
                return names[hexId] || `å¦è±¡-${hexId}`;
            },

            hexagramInterpretation(hexId) {
                const interpretations = [
                    "åˆšå¥ä¸­æ­£ï¼Œè‡ªå¼ºä¸æ¯ã€‚ä¿æŒè¿›å–å¿ƒï¼Œé€‚åˆå¼€å§‹æ–°é¡¹ç›®ã€‚",
                    "åšå¾·è½½ç‰©ï¼ŒåŒ…å®¹ä¸‡ç‰©ã€‚ä¿æŒè€å¿ƒï¼Œä»¥æŸ”å…‹åˆšã€‚",
                    "ä¸‡äº‹èµ·å¤´éš¾ã€‚ä¿æŒå†·é™ï¼ŒæŒ‰éƒ¨å°±ç­å¤„ç†äº‹åŠ¡ã€‚",
                    "è’™ä»¥å…»æ­£ã€‚ä¿æŒå­¦ä¹ çš„æ€åº¦ï¼Œä¸è¦æ€¥äºæ±‚æˆã€‚",
                    "ç­‰å¾…æ—¶æœºã€‚ä¿æŒè€å¿ƒï¼Œç­‰å¾…æœ€ä½³æ—¶æœºè¡ŒåŠ¨ã€‚",
                    "è®¼ä¸å¯é•¿ã€‚é¿å…å†²çªï¼Œå¯»æ±‚å’Œè§£ä¸åˆä½œã€‚",
                    "å¸ˆå‡ºä»¥å¾‹ã€‚ç»Ÿä¸€ç›®æ ‡ï¼Œå›¢ç»“åä½œï¼Œä»¥å¾·æœäººã€‚",
                    "äº²å¯†æ— é—´ã€‚åŠ å¼ºæ²Ÿé€šï¼Œå»ºç«‹ä¿¡ä»»å…³ç³»ã€‚",
                    "ç§¯è“„åŠ›é‡ã€‚ä¿æŒè°¦é€Šï¼Œç¨³æ­¥å‰è¿›ã€‚",
                    "å±¥è¡Œæ‰¿è¯ºã€‚è¯šå®å®ˆä¿¡ï¼Œè¨€è¡Œä¸€è‡´ã€‚",
                    "æ³°ç„¶å¤„ä¹‹ã€‚ä¿æŒä¹è§‚ï¼Œé¡ºåº”æ—¶åŠ¿ã€‚",
                    "å¦ææ³°æ¥ã€‚ä¿æŒä¿¡å¿µï¼Œç­‰å¾…è½¬æœºã€‚",
                    "é½å¿ƒååŠ›ã€‚å›¢ç»“ä¸€è‡´ï¼Œå…±åŒåŠªåŠ›ã€‚",
                    "å¤§æœ‰ä½œä¸ºã€‚æŠŠæ¡æœºé‡ï¼Œå±•ç¤ºæ‰åã€‚",
                    "è°¦è°¦å›å­ã€‚ä¿æŒè°¦é€Šï¼Œè™šå¿ƒå­¦ä¹ ã€‚",
                    "ä¹å¤©çŸ¥å‘½ã€‚ä¿æŒä¹è§‚ï¼Œäº«å—ç”Ÿæ´»ã€‚",
                    "é¡ºå…¶è‡ªç„¶ã€‚ä¿æŒçµæ´»ï¼Œéšé‡è€Œå®‰ã€‚",
                    "æ•´é¡¿ç§©åºã€‚å‘ç°é—®é¢˜ï¼ŒåŠæ—¶çº æ­£ã€‚",
                    "æ¸å…¥ä½³å¢ƒã€‚ç¨³æ­¥å‰è¿›ï¼Œè¶Šæ¥è¶Šå¥½ã€‚",
                    "è§‚å¯Ÿæ€è€ƒã€‚ä¿æŒå†·é™ï¼Œå¤šè§‚å¯Ÿå¤šæ€è€ƒã€‚",
                    "æƒ©å‰æ¯–åã€‚æ¥å—æ•™è®­ï¼Œæ”¹è¿›æ–¹æ³•ã€‚",
                    "å…‰å½©ç…§äººã€‚å±•ç°æ‰åï¼Œè¿½æ±‚ç¾å¥½ã€‚",
                    "é¡ºåŠ¿è€Œä¸ºã€‚é¡ºåº”æ—¶åŠ¿ï¼Œé¿å…å¼ºæ±‚ã€‚",
                    "å¦ææ³°æ¥ã€‚å›°éš¾åªæ˜¯æš‚æ—¶çš„ã€‚",
                    "å…‰æ˜æ­£å¤§ã€‚ä¿æŒæ­£ç›´ï¼ŒåšæŒåŸåˆ™ã€‚",
                    "å¤§ç•œå¾·æ€§ã€‚ç§¯ç´¯å“å¾·ï¼Œæå‡è‡ªå·±ã€‚",
                    "é¢å…»èº«å¿ƒã€‚æ³¨æ„å¥åº·ï¼Œä¿æŒå¹³è¡¡ã€‚",
                    "éå¸¸æ—¶æœŸã€‚å‹‡äºé¢å¯¹ï¼ŒåŒ–å±ä¸ºæœºã€‚",
                    "åˆšæŸ”å¹¶æµã€‚ä¿æŒå¹³è¡¡ï¼Œä¸è¦åæ¿€ã€‚",
                    "ä¾é™„æŸ”é¡ºã€‚ä¿æŒçœŸè¯šï¼Œç›¸äº’ä¾å­˜ã€‚",
                    "äº’ç›¸æ„Ÿåº”ã€‚å»ºç«‹é»˜å¥‘ï¼Œå¢è¿›æ„Ÿæƒ…ã€‚",
                    "æŒä¹‹ä»¥æ’ã€‚ä¿æŒæ¯…åŠ›ï¼Œé•¿æœŸåšæŒã€‚",
                    "æ˜å“²ä¿èº«ã€‚ä¿æŒæ¸…é†’ï¼Œé¿å…é£é™©ã€‚",
                    "é”æ„è¿›å–ã€‚æŠ“ä½æœºä¼šï¼Œå¥‹å‹‡å‘å‰ã€‚",
                    "å…‰æ˜æ˜¾ç°ã€‚å±•ç°å…‰èŠ’ï¼Œç…§äº®å‰è·¯ã€‚",
                    "éŸ¬å…‰å…»æ™¦ã€‚ä¿æŒä½è°ƒï¼Œç­‰å¾…æ—¶æœºã€‚",
                    "è‰°éš¾é™©é˜»ã€‚å…‹æœå›°éš¾ï¼Œç»§ç»­å‰è¿›ã€‚",
                    "åŒ–é™©ä¸ºå¤·ã€‚å‹‡æ•¢é¢å¯¹ï¼Œè½¬å±ä¸ºå®‰ã€‚",
                    "æŸç›Šå¹³è¡¡ã€‚æœ‰æ‰€å–èˆï¼Œä¿æŒå¹³è¡¡ã€‚",
                    "ç§¯æè¿›å–ã€‚æŠŠæ¡æœºä¼šï¼ŒåŠªåŠ›å‘å‰ã€‚",
                    "å†³æ–­æœ‰åŠ›ã€‚æœæ–­è¡ŒåŠ¨ï¼ŒæŠ“ä½æœºä¼šã€‚",
                    "ç›¸é‡è‰¯æœºã€‚çæƒœæœºä¼šï¼ŒæŠŠæ¡å½“ä¸‹ã€‚",
                    "èšé›†åŠ›é‡ã€‚å›¢ç»“åˆä½œï¼Œå…±åŒå‰è¿›ã€‚",
                    "ç¨³æ­¥ä¸Šå‡ã€‚è„šè¸å®åœ°ï¼Œæ­¥æ­¥ä¸ºè¥ã€‚",
                    "åšå®ˆåŸåˆ™ã€‚ä¿æŒåˆå¿ƒï¼Œä¸æ”¾å¼ƒã€‚",
                    "é©æ–°æ±‚å˜ã€‚å‹‡äºåˆ›æ–°ï¼Œçªç ´å¸¸è§„ã€‚",
                    "é©æ•…é¼æ–°ã€‚é™¤æ—§å¸ƒæ–°ï¼Œå¼€åˆ›æœªæ¥ã€‚",
                    "é›·å‰é£è¡Œã€‚è¿…é€Ÿè¡ŒåŠ¨ï¼Œæœæ–­æœ‰åŠ›ã€‚",
                    "ç¨³å¦‚æ³°å±±ã€‚ä¿æŒç¨³å®šï¼Œæ²‰ç€å†·é™ã€‚",
                    "å¾ªåºæ¸è¿›ã€‚ç¨³æ­¥å‰è¿›ï¼Œä¸æ€¥ä¸èºã€‚",
                    "æ¬¢å–œå¿«ä¹ã€‚ä¿æŒå¿«ä¹ï¼Œäº«å—ç”Ÿæ´»ã€‚",
                    "ä¸°åŠŸä¼Ÿç»©ã€‚å–å¾—æˆå°±ï¼Œå±•ç°ä»·å€¼ã€‚",
                    "æ—…é€”é€šè¾¾ã€‚é¡ºåˆ©å‰è¿›ï¼Œä¸€è·¯ç•…é€šã€‚",
                    "é£è¡Œæ°´ä¸Šã€‚ä¿æŒçµæ´»ï¼Œé¡ºåŠ¿è€Œä¸ºã€‚",
                    "å–œæ‚¦æ»¡æ€€ã€‚ä¿æŒå¿ƒæƒ…ï¼Œäº«å—ç”Ÿæ´»ã€‚",
                    "æ¶£ç„¶å†°é‡Šã€‚æ¶ˆé™¤éš”é˜‚ï¼Œå¢è¿›ç†è§£ã€‚",
                    "èŠ‚åˆ¶æœ‰åº¦ã€‚ä¿æŒå¹³è¡¡ï¼Œä¸è¦è¿‡åº¦ã€‚",
                    "è¯šä¿¡ä¸ºæœ¬ã€‚ä¿æŒè¯šä¿¡ï¼Œå»ºç«‹ä¿¡ä»»ã€‚",
                    "å°è¿‡æ— ä¼¤ã€‚å°é—®é¢˜ä¸å½±å“å¤§å±€ã€‚",
                    "æ°´ç«æ—¢æµã€‚äº‹ä¸šæœ‰æˆï¼Œåœ†æ»¡å®Œæˆã€‚",
                    "æœªæµä¹‹æ—¶ã€‚ç»§ç»­åŠªåŠ›ï¼Œè¿½æ±‚å®Œç¾ã€‚"
                ];
                return interpretations[hexId] || "ä¿æŒå¹³å’Œå¿ƒæ€ï¼Œé¡ºåº”è‡ªç„¶è§„å¾‹ã€‚";
            },

            getElementsAdvice(elements) {
                const advice = [];
                if (elements.wood < 0) advice.push("æœ¨å¼±ï¼šå¤šåƒç»¿è‰²è”¬èœï¼Œæ¥è§¦è‡ªç„¶ï¼Œå…»è‚æŠ¤è‚");
                if (elements.fire < 0) advice.push("ç«å¼±ï¼šå¤šåƒçº¢è‰²é£Ÿç‰©ï¼Œé€‚å½“è¿åŠ¨ï¼Œå…»å¿ƒå®‰ç¥");
                if (elements.earth < 0) advice.push("åœŸå¼±ï¼šå¤šåƒé»„è‰²é£Ÿç‰©ï¼Œä¿æŒè§„å¾‹ä½œæ¯ï¼Œå¥è„¾å…»èƒƒ");
                if (elements.metal < 0) advice.push("é‡‘å¼±ï¼šå¤šåƒç™½è‰²é£Ÿç‰©ï¼Œæ·±å‘¼å¸é”»ç‚¼ï¼Œæ¶¦è‚ºå…»æ°”");
                if (elements.water < 0) advice.push("æ°´å¼±ï¼šå¤šåƒé»‘è‰²é£Ÿç‰©ï¼Œå……è¶³é¥®æ°´ï¼Œè¡¥è‚¾å›ºç²¾");
                if (advice.length === 0) advice.push("äº”è¡Œå¹³è¡¡ï¼Œç»§ç»­ä¿æŒè‰¯å¥½ç”Ÿæ´»ä¹ æƒ¯ã€‚");
                return advice;
            },

            getClothingAdvice(elements) {
                const month = new Date().getMonth() + 1;
                const advice = [];

                if (month >= 3 && month <= 5) advice.push("æ˜¥å­£ï¼šä»¥è½»ä¾¿é€æ°”ä¸ºä¸»ï¼Œæ³¨æ„ä¿æš–é˜²é£");
                else if (month >= 6 && month <= 8) advice.push("å¤å­£ï¼šä»¥æ¸…çˆ½é€æ°”ä¸ºä¸»ï¼Œé€‰æ‹©æ£‰éº»æè´¨");
                else if (month >= 9 && month <= 11) advice.push("ç§‹å­£ï¼šæ³¨æ„åˆ†å±‚ç©¿æ­ï¼Œéšæ—¶å¢å‡è¡£ç‰©");
                else advice.push("å†¬å­£ï¼šæ³¨æ„ä¿æš–ï¼Œé€‰æ‹©åšå®é¢æ–™");

                const strongestElement = Object.keys(elements).reduce((a, b) =>
                    elements[a] > elements[b] ? a : b);
                const colorMap = { wood: "ç»¿è‰²ã€é’è‰²ç³»", fire: "çº¢è‰²ã€ç²‰è‰²ç³»", earth: "é»„è‰²ã€æ£•è‰²ç³»", metal: "ç™½è‰²ã€é‡‘è‰²ç³»", water: "é»‘è‰²ã€è“è‰²ç³»" };
                advice.push(`äº”è¡Œè‰²ï¼š${colorMap[strongestElement]}ä¸ä»Šæ—¥è¿åŠ¿ç›¸åˆ`);
                return advice;
            },

            getDietAdvice(elements) {
                const foodMap = {
                    wood: { foods: "ç»¿å¶è”¬èœã€è±†ç±»ã€ç»¿è‰²æ°´æœ", note: "æœ‰åŠ©äºç–è‚è§£éƒ" },
                    fire: { foods: "çº¢æ£ã€çº¢è±†ã€è¥¿çº¢æŸ¿ã€è‹¹æœ", note: "æœ‰åŠ©äºå…»å¿ƒå®‰ç¥" },
                    earth: { foods: "å°ç±³ã€å±±è¯ã€å—ç“œã€çº¢è–¯", note: "æœ‰åŠ©äºå¥è„¾å…»èƒƒ" },
                    metal: { foods: "é›ªæ¢¨ã€ç™¾åˆã€ç™½èåœã€é“¶è€³", note: "æœ‰åŠ©äºæ¶¦è‚ºå…»æ°”" },
                    water: { foods: "é»‘è±†ã€é»‘èŠéº»ã€æ ¸æ¡ƒã€é»‘æœ¨è€³", note: "æœ‰åŠ©äºè¡¥è‚¾å›ºç²¾" }
                };
                const sortedElements = Object.entries(elements).sort((a, b) => b[1] - a[1]).slice(0, 2);
                const advice = [];
                sortedElements.forEach(([element, strength]) => {
                    if (strength >= 0) advice.push(`${foodMap[element].foods}ï¼š${foodMap[element].note}`);
                });
                advice.push("å»ºè®®ï¼šå‡è¡¡é¥®é£Ÿï¼Œé€‚é‡é¥®æ°´ï¼Œé¿å…æš´é¥®æš´é£Ÿ");
                return advice;
            },

            generateDailyTasks(hexId, lifePath) {
                const tasks = ["è”ç³»ä¸€ä½ä¹…æœªè”ç³»çš„æœ‹å‹æˆ–äº²äºº", "å†™ä¸‹ä»Šæ—¥ä¸‰ä»¶æ„Ÿæ©çš„äº‹æƒ…", "èŠ±10åˆ†é’Ÿå†¥æƒ³æˆ–æ·±å‘¼å¸",
                    "æ•´ç†ä¸€ä»¶å›°æ‰°ä½ çš„äº‹æƒ…", "èµç¾æˆ–å¸®åŠ©ä¸€ä½èº«è¾¹çš„äºº", "å®Œæˆä¸€ä»¶ä½ æ‹–å»¶å·²ä¹…çš„ä»»åŠ¡",
                    "å°è¯•ä¸€ç§æ–°çš„é£Ÿç‰©æˆ–æ´»åŠ¨", "æ•´ç†æ‰‹æœºé‡Œçš„ç…§ç‰‡æˆ–æ–‡ä»¶", "ç»™è‡ªå·±å†™ä¸€æ®µé¼“åŠ±çš„è¯",
                    "è§‚å¯Ÿå‘¨å›´çš„ç¾å¥½äº‹ç‰©"];
                const selectedTasks = [];
                const seed = (hexId + lifePath) % tasks.length;
                selectedTasks.push(tasks[seed]);
                selectedTasks.push(tasks[(seed + 3) % tasks.length]);
                selectedTasks.push(tasks[(seed + 7) % tasks.length]);
                return selectedTasks;
            },

            generateJournalPrompts(hexId, lifePath) {
                const prompts = ["ä»Šå¤©ä½ å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ", "ä»€ä¹ˆäº‹æƒ…è®©ä½ æ„Ÿåˆ°å¼€å¿ƒï¼Ÿ", "ä½ ä»Šå¤©å¸®åŠ©äº†è°ï¼Ÿ",
                    "ä»€ä¹ˆæŒ‘æˆ˜ä½ ä»Šå¤©å…‹æœäº†ï¼Ÿ", "ä½ ä»Šå¤©å¦‚ä½•ç…§é¡¾äº†è‡ªå·±ï¼Ÿ", "ä»Šå¤©æœ€éš¾å¿˜çš„ç¬é—´æ˜¯ä»€ä¹ˆï¼Ÿ",
                    "ä½ ä»Šå¤©ä¸ºæœªæ¥åšäº†ä»€ä¹ˆï¼Ÿ", "ä»Šå¤©ä½ å‘ç°äº†ä»€ä¹ˆæ–°äº‹ç‰©ï¼Ÿ", "ä½ ä»Šå¤©çš„å¿ƒæƒ…å¦‚ä½•ï¼Ÿ", "ä»Šå¤©ä½ æƒ³æ”¹å˜ä»€ä¹ˆï¼Ÿ"];
                const selectedPrompts = [];
                const seed = (hexId + lifePath) % prompts.length;
                selectedPrompts.push(prompts[seed]);
                selectedPrompts.push(prompts[(seed + 5) % prompts.length]);
                return selectedPrompts;
            },

            generateFortune(birthday) {
                const today = new Date().toISOString().split('T')[0];
                const seedStr = birthday + today;
                const seed = this.hashString(seedStr);
                const hexId = seed % 64;
                const lifePath = this.lifePathFromBirthday(birthday);
                const elements = this.fiveElementsFromBirthday(birthday);
                return {
                    hexagramId: hexId,
                    hexagramName: this.hexagramName(hexId),
                    hexagramInterpretation: this.hexagramInterpretation(hexId),
                    lifePathNumber: lifePath,
                    lifePathDesc: this.lifePathDesc(lifePath),
                    elements,
                    luckyColor: this.colorFromSeed(seed),
                    luckyNumber: this.luckyNumber(lifePath, hexId),
                    date: today
                };
            },

            buildCards(fortune) {
                const el = fortune.elements;
                const clothingAdvice = this.getClothingAdvice(el);
                const dietAdvice = this.getDietAdvice(el);
                const elementsAdvice = this.getElementsAdvice(el);
                const dailyTasks = this.generateDailyTasks(fortune.hexagramId, fortune.lifePathNumber);
                const journalPrompts = this.generateJournalPrompts(fortune.hexagramId, fortune.lifePathNumber);

                return [
                    { id: 'c1', title: 'æœ¬æ—¥å¦è±¡', content: `${fortune.hexagramName}\n${fortune.hexagramInterpretation}`, color: fortune.luckyColor, icon: 'ğŸ”®' },
                    { id: 'c2', title: 'ç”Ÿå‘½è·¯å¾„', content: `ç”Ÿå‘½è·¯å¾„æ•°ï¼š${fortune.lifePathNumber}\n${fortune.lifePathDesc}`, color: '#667eea', icon: 'ğŸŒŸ' },
                    { id: 'c3', title: 'äº”è¡Œå¹³è¡¡', content: `æœ¨ ${el.wood} / ç« ${el.fire} / åœŸ ${el.earth} / é‡‘ ${el.metal} / æ°´ ${el.water}\n\n${elementsAdvice.join('\n')}`, color: '#4ECDC4', icon: 'â˜¯ï¸' },
                    { id: 'c4', title: 'å¹¸è¿è¦ç´ ', content: `å¹¸è¿è‰²ï¼š${fortune.luckyColor}\nå¹¸è¿æ•°å­—ï¼š${fortune.luckyNumber}`, color: fortune.luckyColor, icon: 'ğŸ€' },
                    { id: 'c5', title: 'ç©¿è¡£çµæ„Ÿ', content: clothingAdvice.join('\n'), color: '#45B7D1', icon: 'ğŸ‘”' },
                    { id: 'c6', title: 'é¥®é£Ÿå»ºè®®', content: dietAdvice.join('\n'), color: '#52c41a', icon: 'ğŸ²' },
                    { id: 'c7', title: 'æ¯æ—¥å¾®ä»»åŠ¡', content: dailyTasks.map((task, i) => `${i + 1}. ${task}`).join('\n'), color: '#FFA07A', icon: 'âœ…' },
                    { id: 'c8', title: 'æ—¥è®° Prompts', content: journalPrompts.map((prompt, i) => `æ€è€ƒ ${i + 1}: ${prompt}`).join('\n'), color: '#BB8FCE', icon: 'ğŸ“' },
                    { id: 'c9', title: 'å¥åº·æé†’', content: 'è®°å¾—å¤šå–æ°´ï¼Œä¿æŒè§„å¾‹ä½œæ¯ï¼Œé€‚å½“è¿åŠ¨ã€‚\nä»Šæ—¥å»ºè®®é¥®æ°´é‡ï¼š1.5-2.5å‡', color: '#85C1E9', icon: 'ğŸ’§' },
                    { id: 'c10', title: 'éšç§è¯´æ˜', content: 'æœ¬åº”ç”¨ä¼˜å…ˆæœ¬åœ°å­˜å‚¨ï¼Œæ¨ç®—ç»“æœä»…åŸºäºæ‚¨çš„ç”Ÿæ—¥ã€‚\næ‰‹æœºå·ä»…ç”¨äºèº«ä»½è¯†åˆ«ï¼Œå·²è„±æ•å¤„ç†ã€‚', color: '#999', icon: 'ğŸ”’' }
                ];
            }
        };

        // Initialize
        const birthdayInput = document.getElementById('birthday');
        const genderInput = document.getElementById('gender');
        const generateBtn = document.getElementById('generateBtn');
        const cardsContainer = document.getElementById('cardsContainer');
        const dateBadge = document.getElementById('dateBadge');

        // Set today's date
        dateBadge.textContent = `ğŸ“… ${new Date().toLocaleDateString('zh-CN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`;

        // Enable/disable button
        birthdayInput.addEventListener('change', () => {
            generateBtn.disabled = !birthdayInput.value;
        });

        // Generate fortune
        generateBtn.addEventListener('click', () => {
            const birthday = birthdayInput.value;
            if (!birthday) return;

            // Show loading
            cardsContainer.innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>æ­£åœ¨ä¸ºæ‚¨æ¨ç®—ä»Šæ—¥è¿åŠ¿...</p></div>';

            // Simulate delay
            setTimeout(() => {
                const fortune = fortuneEngine.generateFortune(birthday);
                const cards = fortuneEngine.buildCards(fortune);

                cardsContainer.innerHTML = '<div class="section-title">ğŸ“Š ä»Šæ—¥æ¨ç®—</div>' +
                    cards.map(card => `
                        <div class="card" style="border-left-color: ${card.color};" onclick="toggleCard(this)">
                            <div class="card-header">
                                <div class="card-title">
                                    <span class="card-icon">${card.icon}</span>
                                    ${card.title}
                                </div>
                                <div class="card-toggle">å±•å¼€</div>
                            </div>
                            <div class="card-content">
                                <div class="card-content-text">${card.content}</div>
                            </div>
                        </div>
                    `).join('');
            }, 800);
        });

        // Toggle card
        function toggleCard(cardElement) {
            cardElement.classList.toggle('expanded');
            const toggle = cardElement.querySelector('.card-toggle');
            toggle.textContent = cardElement.classList.contains('expanded') ? 'æ”¶èµ·' : 'å±•å¼€';
        }
    </script>
</body>
</html>
