# 登录优化说明

## 变更内容

已优化登录流程，现在支持两种登录方式：

### 第一次登录（新用户）
1. 输入手机号 → 点击"发送验证码"
2. 输入验证码（1234）→ 点击"下一步"
3. 设置密码（必填，至少6位）→ 点击"登录"
4. 自动注册并登录

### 第二次登录（已注册用户）
支持**两种登录方式**：

#### 方式1：验证码登录
1. 输入手机号 → 点击"发送验证码"
2. 输入验证码（1234）→ 点击"下一步"
3. 密码留空 → 点击"登录"
4. 直接登录成功

#### 方式2：密码登录
1. 输入手机号 → 点击"发送验证码"
2. 输入验证码（1234）→ 点击"下一步"
3. 输入密码 → 点击"登录"
4. 登录成功

## 技术实现

### 后端变更
1. `sendCode` 接口返回 `isRegistered` 标记，告知前端用户是否已注册
2. `login` 接口支持两种登录方式：
   - 验证码登录：只传 `{ phone, code }`
   - 密码登录：只传 `{ phone, password }`
   - 验证码和密码都传：优先使用验证码登录

### 前端变更
1. `handleSendCode` 函数保存 `isRegistered` 状态
2. `handleNext` 函数根据 `isRegistered` 显示不同的提示信息
3. `handleLogin` 函数根据用户输入判断使用验证码还是密码登录
4. 密码字段改为可选，新用户必填，老用户可选

## 测试步骤

### 测试新用户注册
1. 输入新手机号（如：18888888888）
2. 发送验证码（1234）
3. 输入验证码
4. 设置密码
5. 登录成功

### 测试已注册用户-验证码登录
1. 输入已注册手机号
2. 发送验证码（1234）
3. 输入验证码
4. **不输入密码**
5. 点击登录，应该成功

### 测试已注册用户-密码登录
1. 输入已注册手机号
2. 发送验证码（1234）
3. 输入验证码
4. **输入正确的密码**
5. 点击登录，应该成功

## 注意事项

- 演示模式验证码固定为：`1234`
- 新用户必须设置密码（至少6位）
- 密码强度指示器在密码为空时自动隐藏
- 已注册用户可以选择任意一种方式登录
